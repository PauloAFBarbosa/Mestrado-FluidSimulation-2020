<?xml version="1.0"  encoding="UTF-8"?>
<project name="SPH_Fluid_Sim" width = "1280" height = "720">
	<assets>
		<constants>
			<constant name="NUMBER_OF_PARTICLES" value="1000000" />
			<constant name="NUMBER_OF_VERTICES"  value="6000000" />
			<!-- Lança com 625 workgroups. Cada workgroup vai ter 25 threads-->
			<constant name="NUMBER_OF_WORK_GROUPS" value="31250" />
			<constant name="NUMBER_OF_WORK_GROUPS_DENSITY_PRESSURE" value="15625" />

			<constant name="HASH_SIZE" value="20000" />

			
			<constant name="FLUID_RES_W" value="1280"/> <constant name="FLUID_RES_H" value="720"/>



			
			
			<constant name="SMOOTH_GROUP_X" value="1"/><constant name="SMOOTH_GROUP_Y" value="1"/>
			<!-->
				<constant name="FLUID_RES_W" value="1024"/><constant name="FLUID_RES_H" value="576"/>
				<constant name="FLUID_RES_W" value="1024"/><constant name="FLUID_RES_H" value="576"/>
				<constant name="SMOOTH_GROUP_X" value="32"/><constant name="SMOOTH_GROUP_Y" value="18"/>
				<constant name="FLUID_RES_W" value="1024"/><constant name="FLUID_RES_H" value="576"/>

				<constant name="FLUID_RES_W" value="512"/>	<constant name="FLUID_RES_H" value="288"/>
				<constant name="SMOOTH_GROUP_X" value="16"/><constant name="SMOOTH_GROUP_Y" value="9"/>

				<constant name="FLUID_RES_W" value="1920"/> <constant name="FLUID_RES_H" value="1080"/>
				<constant name="SMOOTH_GROUP_X" value="60"/><constant name="SMOOTH_GROUP_Y" value="34"/>nao multiplo

				<constant name="FLUID_RES_W" value="1280"/> <constant name="FLUID_RES_H" value="720"/>
				<constant name="SMOOTH_GROUP_X" value="40"/><constant name="SMOOTH_GROUP_Y" value="23"/>nao multiplo
			<-->
		</constants>
        <attributes>
			<!-- Atributos Rendering -->
				<attribute name="Particle_Radius" 			data="FLOAT" 	type="RENDERER" value="0.005"/>
				<attribute name="Particle_Resting_Density" 	data="INT" 		type="RENDERER" value="1000" />
				<attribute name="Particle_Mass" 			data="FLOAT" 	type="RENDERER" value="0.02" />
				<attribute name="Particle_Stiffness" 		data="INT" 		type="RENDERER" value="2000" />
				<attribute name="Number_Particles" 			data="INT" 		type="RENDERER" value="NUMBER_OF_PARTICLES"/>
				<attribute name="Particle_Color" 			data="VEC4" 	type="RENDERER" x="0.0" y="0.3" z="0.3" w="1"/>
				<attribute name="Thin_Color" 				data="VEC4" 	type="RENDERER" x="0.8" y="1.0" z="1.0" w="1"/>
				<attribute name="ETA"						data="FLOAT" 	type="RENDERER" value="1.1" />
				<attribute name="Blur"						data="INT" 		type="RENDERER" value="0" />
				<attribute name="DebugParticles"			data="INT" 		type="RENDERER" value="1" />
				<attribute name="Particle_alpha"			data="FLOAT" 	type="RENDERER" value="0.02" />
				<attribute name="Particle_Size"				data="VEC3" 	type="RENDERER" x="0.015" y="0.01" z="0.01" />
				<attribute name="ThickType" 				data="INT"		type="RENDERER" value="2"  />
				<attribute name="Blur_Quality" 				data="FLOAT" 	type="RENDERER" value="6"  />
				<attribute name="Blur_Size" 				data="FLOAT" 	type="RENDERER" value="18"  />
				<attribute name="FLUID_RES" 				data="VEC2" 	type="RENDERER" x="FLUID_RES_W" y="FLUID_RES_H"  />
				<attribute name="Surface_Num" 				data="INT" 		type="RENDERER" value="2"  />

				<attribute name="filterRadius" 		 data="INT" type="RENDERER" value="4"  />
				<attribute name="sphereRadius" 		 data="FLOAT" type="RENDERER" value="0.0100"  />
				<attribute name="bilateralParameter" data="FLOAT" type="RENDERER" value="0.08000"  />

				<attribute name="WAVE_CLEAR" data="INT" type="RENDERER" value="0"  />
				<attribute name="WAVE_NUM_DIR" data="INT" type="RENDERER" value="0"  />
				<attribute name="WAVE_PERIOD" 	data="FLOAT" type="RENDERER" value="1000"  />
				<attribute name="WAVE_STRENGTH" data="FLOAT" type="RENDERER" value="3"  />
			<!-- Atributos Simulaçao -->
				<attribute name="Pause"						data="INT" 	type="RENDERER" value="1" />
				<attribute name="External_Force" 			data="VEC3" 	type="RENDERER" x="0" y="0.0" z="0.0" />
				<attribute name="Viscosity"					data="FLOAT" 	type="RENDERER" value="3000" />
				<attribute name="RESTITUTION"				data="FLOAT" type="RENDERER" value="0.5"/>
				<attribute name="WALL_DAMPING"				data="FLOAT" type="RENDERER" value="0.5"/>
				<attribute name="TIMESTEP" 					data="FLOAT" type="RENDERER" value = "0.01" />
				<attribute name="SURFACETENSION" 			data="FLOAT" type="RENDERER" value = "0.0728" />
				<attribute name="THRESHOLD" 				data="FLOAT" type="RENDERER" value = "7.065" />
				<attribute name="H" 						data="FLOAT" type="RENDERER" value = "0.0457" />
				<attribute name="STIFF" 					data="FLOAT" type="RENDERER" value = "3.0" />
				<attribute name="DECLIVE" 					data="FLOAT" type="RENDERER" value = "0.0" />
				<attribute name="MASS" 						data="FLOAT" type="RENDERER" value = "0.02" />
				<attribute name="RESTDENSITY" 				data="FLOAT" type="RENDERER" value = "1000.0" />
				<attribute name="VISCOSITY" 				data="FLOAT" type="RENDERER" value = "4.5" />
				<attribute name="GRAVITY" 					data="VEC4" type="RENDERER" x = "0" y = "-9.8" z = "0" w="0" />
				<attribute name="Ball" 					data="VEC4" type="RENDERER" x = "2" y = "2" z = "2" w="0" />
				<attribute name="BallSize" 					data="FLOAT" type="RENDERER" value="0.1" />
	
				<attribute name="PONTOS_LADO" 				data="INT" 		type="RENDERER" value="100"/>
				<attribute name="HASHSIZE" 					data="INT" 		type="RENDERER" value="HASH_SIZE"/>
				<!--Usado para definir o volume onde vai ser feita a simulação-->
				<!--X pode ir de -2.17 até 2.17 -->
				<!--Y pode ir de -2 até 2 -->
				<!--Z pode ir de -2.9 até 2.9 -->
				<attribute name="XMIN" 						data="FLOAT" 		type="RENDERER" value="-2.17"/>
				<attribute name="XMAX" 						data="FLOAT" 		type="RENDERER" value="2.17"/>
				<attribute name="YMIN" 						data="FLOAT" 		type="RENDERER" value="-2.0"/>
				<attribute name="YMAX" 						data="FLOAT" 		type="RENDERER" value="2.0"/>
				<attribute name="ZMIN" 						data="FLOAT" 		type="RENDERER" value="-2.9"/>
				<attribute name="ZMAX" 						data="FLOAT" 		type="RENDERER" value="2.9"/>
		</attributes>

		<scenes>
			<scene name="Sphere">
				<geometry name = "sphere" type = "SPHERE" />
				<TRANSLATE x="1" y="1" z="1" />
				<SCALE x="0.025" y="0.05" z="0.025" />
			</scene>
			<scene name = "Skybox">
                <geometry name = "cube_skybox" type = "BOX" material="mat_skybox" />
            </scene>

			<scene name="New_Particles">
				<buffers name="Stuff" primitive="TRIANGLES" material="Default">
					<position name="ParticleTriangles" fromLibrary="renderingLib"/>
				</buffers>
			</scene>
		</scenes>
		
		<viewports>
			<viewport name="MainViewport">
			</viewport>
		</viewports>
		
		<cameras>
			<camera name="MainCamera" >
				<viewport name="MainViewport" />
				<POSITION x="0.0" y="0.0" z="4.0" />
				<NEAR 	value="0.02" />
				<FAR 	value="100" /> 
				<LOOK_AT_POINT x="-0.053" y="-1.0" z="0.936"/>
			</camera>
		</cameras>
		
		<lights>
			<light name="Sun">
				<DIRECTION x="0" y="-1" z="-1" />
			</light>
		</lights>

        <materialLibs>
			<materialLib filename="simulation.mlib" />
			<materialLib filename="rendering.mlib" />
		</materialLibs>
	</assets>
	
	<pipelines default="pip">
		<pipeline name="pip">
			<!-- SIMULATION -->
			<pass class="compute" name="Init">
				<mode value="RUN_ONCE"/>
				<material name="Init" fromLibrary="simulationLib" dimX="1" dimY="1" dimZ="1"/>
			</pass >

			
			<pass class="cudaPI" name="MyNewSort">
				
				<materialMaps>
					<map fromMaterial="*" toMaterial="MyNewSort" toLibrary="simulationLib" />
				</materialMaps>
				
			</pass>

			
			
			<pass class="compute" name="DensityPressure">
				<material name="density_pressure" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS_DENSITY_PRESSURE" dimY="1" dimZ="1"/>
			</pass>
			<pass class="compute" name="Force">
				<material name="force" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>
			<pass class="compute" name="Integrate">
				<material name="integrate" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>


			<pass class="compute" name="UpdateIndex">
				<material name="UpdateIndex" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>

			<!-- RENDERING -->
			<pass class="default" name="background">
				<preScript file="scripts/waves.lua" script="waves"/>

				<scenes>
					<scene name="Skybox" />
				</scenes>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<renderTarget name="Background" fromLibrary="renderingLib" />
				<materialMaps>
					<map fromMaterial="mat_skybox" toMaterial="mat_skybox" toLibrary="renderingLib" />
				</materialMaps>
				<injectionMaps>
					<map toMaterial="mat_skybox">
						<state name="cull" fromLibrary="renderingLib" />
					</map>
				</injectionMaps>
			</pass>

			<pass class="default" name="DepthPeeling">
				<scenes>
					<scene name="New_Particles"/>
				</scenes>
				<materialMaps>
					<map fromMaterial="Default" toMaterial="Deferred_Particles" toLibrary="renderingLib" />
				</materialMaps>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<renderTarget name="deferred_particles" fromLibrary="renderingLib" />
			</pass>

			<pass class="default" name="Thickness">
				<scenes>
					<scene name="New_Particles"/>
				</scenes>
				<materialMaps>
					<map fromMaterial="Default" toMaterial="Thickness" toLibrary="renderingLib" />
				</materialMaps>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<renderTarget name="Render" fromLibrary="renderingLib" />
			</pass>
			<pass class="quad" name="smooth_Depth">
				<camera name="MainCamera" />
				<material name="Smooth_Init" fromLibrary="renderingLib"/>
				<renderTarget name="Smoothing_Init" fromLibrary="renderingLib" />
			</pass>
			<pass class="quad" name="smooth_Depth">
				<camera name="MainCamera" />
				<material name="Smooth_Ping" fromLibrary="renderingLib"/>
				<renderTarget name="Smoothing_Ping" fromLibrary="renderingLib" />
			</pass>
			<pass class="quad" name="smooth_Depth">
				<camera name="MainCamera" />
				<material name="Smooth_Pong" fromLibrary="renderingLib"/>
				<renderTarget name="Smoothing_Pong" fromLibrary="renderingLib" />
			</pass>
			
		
			
			
			
			<!-- >
				<pass class="quad" name="smooth_Depth">
					<camera name="MainCamera" />
					<material name="Smooth_Ping" fromLibrary="renderingLib"/>
					<renderTarget name="Smoothing_Ping" fromLibrary="renderingLib" />
				</pass>
				<pass class="quad" name="smooth_Depth">
					<camera name="MainCamera" />
					<material name="Smooth_Pong" fromLibrary="renderingLib"/>
				<renderTarget name="Smoothing_Pong" fromLibrary="renderingLib" />
			</pass>
			
			</-->
			<pass class="quad" name="particlesQuad">
				<camera name="MainCamera" />
				<viewport name="MainViewport" />
				<material name="FinalStep" fromLibrary="renderingLib" />
			</pass>		
		</pipeline>
	</pipelines>

    <interface> 
		<window label = "Render Mode">
            <var label="Color"   			type="RENDERER" context="CURRENT" component="Particle_Color" 	mode="COLOR"/>
            <var label="Thin Color"   		type="RENDERER" context="CURRENT" component="Thin_Color" 	mode="COLOR"/>
            <var label="ETA"				type="RENDERER" context="CURRENT" component="ETA" 	/>
            <var label="Particle_alpha"		type="RENDERER" context="CURRENT" component="Particle_alpha" def="min=0.01 max=0.3" />
            <var label="Particle_Size"		type="RENDERER" context="CURRENT" component="Particle_Size" def="min=0.005 max=0.05"/>
			<var label="ThickType" 			type="RENDERER" context="CURRENT" component="ThickType" 	def="min=1 max=3"/>
			<var label="DebugParticles"		type="RENDERER" context="CURRENT" component="DebugParticles" def="min=0 max=4"/>
            <var label="Blur"				type="RENDERER" context="CURRENT" component="Blur" def="min=0 max=3" />
			<var label="Number of Surfaces"	type="RENDERER" context="CURRENT" component="Surface_Num" def="min=1 max=2" 	/>
        </window>
		<window label="Old Blur Params">
			<var label="Blur Radious" 		type="RENDERER" context="CURRENT" component="Blur_Size" 	def="min=4.0 max=32.0"/>
			<var label="Blur_Quality" 		type="RENDERER" context="CURRENT" component="Blur_Quality" 	def="min=1.0 max=20.0"/>
		</window>
		<window label="Bilateral Params">
			<var label="filterRadius" 			type="RENDERER" context="CURRENT" component="filterRadius" 	/>
			<var label="sphereRadius" 			type="RENDERER" context="CURRENT" component="sphereRadius" 	/>
			<var label="bilateralParameter" 	type="RENDERER" context="CURRENT" component="bilateralParameter" 	/>
		</window>
		<window label="Wave Controller">
			<var label="WAVE_NUM_DIR" 		type="RENDERER" context="CURRENT" component="WAVE_NUM_DIR" def="min=0 max=2" 	/>
			<var label="WAVE_PERIOD" 		type="RENDERER" context="CURRENT" component="WAVE_PERIOD" 	/>
			<var label="WAVE_STRENGTH" 		type="RENDERER" context="CURRENT" component="WAVE_STRENGTH" 	/>
			<var label="WAVE_CLEAR_BUTTON" 	type="RENDERER" context="CURRENT" component="WAVE_CLEAR" def="min=0 max=1"	/>
		</window>
		<window label = "Simulation">
            <var label="Pause"				type="RENDERER" context="CURRENT" component="Pause" 	def="min=0 max=1" />
            <var label="Ball" 			type="RENDERER" context="CURRENT" component="Ball" def="min=-2 max=2 step=0.05"/>
            <var label="BallSize" 			type="RENDERER" context="CURRENT" component="BallSize" def="min=0.1 max=1 step=0.01"/>
			<var label="TIMESTEP" 			type="RENDERER" context="CURRENT" component="TIMESTEP" def="min=0.001 step=0.001 max=0.05"/>
			<var label="SURFACETENSION" 	type="RENDERER" context="CURRENT" component="SURFACETENSION" def="min=0.0001 max=2 step=0.0001" />
			<var label="H" 					type="RENDERER" context="CURRENT" component="H" def="min=0.0457 max=100 step=0.0001"/>
			<var label="STIFF" 				type="RENDERER" context="CURRENT" component="STIFF" def="min=1 max=100 step=1"/>
			<var label="DECLIVE" 			type="RENDERER" context="CURRENT" component="DECLIVE" def="min=-1.0 max=1 step=0.05"/>
			<var label="Wall damping" 			type="RENDERER" context="CURRENT" component="WALL_DAMPING" def="min=0 max=1 step=0.1"/>
			<var label="RESTDENSITY" 		type="RENDERER" context="CURRENT" component="RESTDENSITY" def="min=100 max=10000 step=100"/>
			<var label="VISCOSITY" 			type="RENDERER" context="CURRENT" component="VISCOSITY" def="min=3 max=25 step=0.1"/>
			<var label="GRAVITY" 			type="RENDERER" context="CURRENT" component="GRAVITY" def="min=-20 max=20 step=1"/>
			<var label="RESTITUTION" 		type="RENDERER" context="CURRENT" component="RESTITUTION" def="min=0 max=1 step=0.1"/>
        </window>
    </interface>
</project>