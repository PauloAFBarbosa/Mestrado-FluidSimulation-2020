<?xml version="1.0"  encoding="UTF-8"?>
<project name="Voxel_Fluid_sim" width = "1280" height = "720">
    <assets>
        <constants>
            <!-- VOX SIDE is VOX SIDE GROUPS * 32 -->
            <constant name="VOX_SIDE"   		value="256" />
            <constant name="VOX_SIDE_X" 		value="435.0" />
            <constant name="VOX_SIDE_Y" 		value="402.0" />
            <constant name="VOX_SIDE_Z" 		value="579.0" />
			
            <constant name="VOX_SIDE_GROUPS_X"  value="14" />
            <constant name="VOX_SIDE_GROUPS_Y"  value="13" />

			<constant name="NUMBER_OF_PARTICLES"    value="64000" />
			<constant name="NUMBER_OF_VERTICES"     value="384000" />
			<!-- tem wg com tamanho 32-->
			<constant name="NUMBER_OF_WORK_GROUPS"  value="2000" />
			
			<!-- density pressure tem wg com tamanho 64-->
			<!-- 64*NUMBER_OF_WORK_GROUPS_DENSITY_PRESSURE tem de dar igual ao nr de particulas-->
			<constant name="NUMBER_OF_WORK_GROUPS_DENSITY_PRESSURE" value="27000" />

			<constant name="HASH_SIZE" value="20000" />

			<constant name="FLUID_RES_W" value="1280"/> <constant name="FLUID_RES_H" value="720"/>
	
				<!--X pode ir de -2.17 até 2.17 -->
				<!--Y pode ir de -2 até 2 -->
				<!--Z pode ir de -2.9 até 2.9 -->
			<constant name="XMI" value="-2.17" />
			<constant name="XMA" value=" 2.17" />
			<constant name="YMI" value="-2.0" />
			<constant name="YMA" value=" 2.0" />
			<constant name="ZMI" value="-2.9" />
			<constant name="ZMA" value=" 2.9" />
        </constants>
        
        <attributes>
			<attribute name="ping" data="INT" type="RENDERER" value="0"  />
			<attribute name="pang" data="INT" type="RENDERER" value="1"  />
			<attribute name="pong" data="INT" type="RENDERER" value="2"  />
			
            <attribute name="voxDim" data="INT" type="RENDERER" value="VOX_SIDE"  />
            <attribute name="voxDimVec" data="VEC3" type="RENDERER" x="VOX_SIDE_X" y="VOX_SIDE_Y" z="VOX_SIDE_Z"  />
			
			<attribute name="voxmin" data="VEC3" type="RENDERER" x="-2.17" y="-2.0" z="-2.9"  />
            <attribute name="voxmax" data="VEC3" type="RENDERER" x="2.17" y="2.0" z="2.9"  />

			<attribute name="simmin" data="VEC3" type="RENDERER" x="XMI"  y="YMI"  z="ZMI"  />
			<attribute name="simmax" data="VEC3" type="RENDERER" x="XMA"  y="YMA"  z="ZMA"  />
            
			
        			<!-- Atributos Rendering -->
			<attribute name="Particle_Radius" 			data="FLOAT" 	type="RENDERER" value="0.005"/>
			<attribute name="Particle_Resting_Density" 	data="INT" 		type="RENDERER" value="1000" />
			<attribute name="Particle_Mass" 			data="FLOAT" 	type="RENDERER" value="0.02" />
			<attribute name="Particle_Stiffness" 		data="INT" 		type="RENDERER" value="2000" />
			<attribute name="Number_Particles" 			data="INT" 		type="RENDERER" value="NUMBER_OF_PARTICLES"/>
			<attribute name="Particle_Color" 			data="VEC4" 	type="RENDERER" x="0.0" y="0.7" z="0.9" w="1"/>
			<attribute name="Thin_Color" 				data="VEC4" 	type="RENDERER" x="0.6" y="1.0" z="1.0" w="0.3"/>

			<attribute name="DebugParticles"			data="INT" 		type="RENDERER" value="0" />
			<attribute name="Particle_Thickness"		data="FLOAT" 	type="RENDERER" value="0.8" />
			<attribute name="Particle_Size"				data="VEC3" 	type="RENDERER" x="0.015" y="0.015" z="0.015" />

			<attribute name="stepSize" 				data="FLOAT" 	type="RENDERER" value="0.0500"  />
			<attribute name="maxSteps" 				data="INT"	 	type="RENDERER" value="1000"  />
			<attribute name="power" 				data="INT" 		type="RENDERER" value="5"  />
			<attribute name="specular_power"		data="INT" 		type="RENDERER" value="30"  />

			<attribute name="SkyboxType" data="INT" type="RENDERER" value="0"  />
			<attribute name="maxrefrat" data="INT" type="RENDERER" value="10"  />

			<!-- Atribute Voxel Rendering -->
				<attribute name="densityThreshold" 	data="FLOAT" 	type="RENDERER" value="0.7"  />
				<attribute name="ETA"				data="FLOAT" 	type="RENDERER" value="0.77" />
				<!-- 
					<attribute name="Particle_Color" 	data="VEC4" 	type="RENDERER" x="0.0" y="0.6" z="0.7" w="1"/>
					<attribute name="Thin_Color" 		data="VEC4" 	type="RENDERER" x="0.3" y="1.0" z="1.0" w="0.3"/>
					<attribute name="specular_power"	data="INT" type="RENDERER" value="128"  />
				-->
				<attribute name="shlickpower" 		data="INT" type="RENDERER" value="5"  />
				<attribute name="stepmultiplier" 	data="FLOAT" type="RENDERER" value="0.2"  />

				<attribute name="particleradius" 	data="FLOAT" 	type="RENDERER" value="0.02"  />
				<attribute name="blurradius" 		data="INT" 		type="RENDERER" value="1"  />
			<!-- 					-->
			
			
			<attribute name="WAVE_CLEAR" data="INT" type="RENDERER" value="0"  />
			<attribute name="WAVE_NUM_DIR" data="INT" type="RENDERER" value="0"  />
			<attribute name="WAVE_PERIOD" 	data="FLOAT" type="RENDERER" value="40"  />
			<attribute name="WAVE_STRENGTH" data="FLOAT" type="RENDERER" value="3"  />

			<!-- LUA ATTRIBUTES -->
				<attribute name="Blur_PingPong" 	data="INT" 		type="RENDERER" value="0"  />
				<attribute name="Sim_Iters" 		data="INT" 		type="RENDERER" value="0"  />
				<attribute name="Sim_MaxIters" 		data="INT" 		type="RENDERER" value="0"  />
				<!-- 	
					<attribute name="Sim_MaxIters" 		data="INT" 		type="RENDERER" value="400"  />
				-->
			        <!-- Atributos Simulaçao -->
				<attribute name="Pause"						data="INT" 	type="RENDERER" value="1" />
				<attribute name="Flow"						data="INT" 	type="RENDERER" value="0" />
				<attribute name="computeGravity"						data="INT" 	type="RENDERER" value="0" />
				<attribute name="External_Force" 			data="VEC3" 	type="RENDERER" x="0" y="0.0" z="0.0" />
				<attribute name="Viscosity"					data="FLOAT" 	type="RENDERER" value="3000" />
				<attribute name="RESTITUTION"				data="FLOAT" type="RENDERER" value="0.5"/>
				<attribute name="WALL_DAMPING"				data="FLOAT" type="RENDERER" value="0.5"/>
				<attribute name="TIMESTEP" 					data="FLOAT" type="RENDERER" value = "0.01" />
				<attribute name="SURFACETENSION" 			data="FLOAT" type="RENDERER" value = "0.0728" />
				<attribute name="THRESHOLD" 				data="FLOAT" type="RENDERER" value = "7.065" />
				<attribute name="H" 						data="FLOAT" type="RENDERER" value = "0.0457" />
				<attribute name="SIMULATIONSCALE" 						data="FLOAT" type="RENDERER" value = "1.0" />
				<attribute name="SIMULATIONSCALEFORCE" 						data="FLOAT" type="RENDERER" value = "1.0" />
				<attribute name="STIFF" 					data="FLOAT" type="RENDERER" value = "3.0" />
				
				<attribute name="MASS" 						data="FLOAT" type="RENDERER" value = "0.02" />
				<attribute name="RESTDENSITY" 				data="FLOAT" type="RENDERER" value = "1000.0" />
				<attribute name="VISCOSITY" 				data="FLOAT" type="RENDERER" value = "4.5" />
				<attribute name="GRAVITY" 					data="VEC4" type="RENDERER" x = "0" y = "-9.8" z = "0" w="0" />
				<attribute name="COLLISIONTYPE" 					data="INT" type="RENDERER" value="0" />
	
				<attribute name="PONTOS_LADO" 				data="INT" 		type="RENDERER" value="40"/>
				<attribute name="HASHSIZE" 					data="INT" 		type="RENDERER" value="HASH_SIZE"/>
				<!--Usado para definir o volume onde vai ser feita a simulação-->
				<!--X pode ir de -2.17 até 2.17 -->
				<!--Y pode ir de -2 até 2 -->
				<!--Z pode ir de -2.9 até 2.9 -->
				<attribute name="XMIN" 						data="FLOAT" 		type="RENDERER" value="-2.17"/>
				<attribute name="XMAX" 						data="FLOAT" 		type="RENDERER" value="2.17"/>
				<attribute name="YMIN" 						data="FLOAT" 		type="RENDERER" value="-2.0"/>
				<attribute name="YMAX" 						data="FLOAT" 		type="RENDERER" value="2.0"/>
				<attribute name="ZMIN" 						data="FLOAT" 		type="RENDERER" value="-2.9"/>
				<attribute name="ZMAX" 						data="FLOAT" 		type="RENDERER" value="2.9"/>
				
				<attribute name="SAVEXMIN" 						data="FLOAT" 		type="RENDERER" value="-2.17"/>
				<attribute name="SAVEZMIN" 						data="FLOAT" 		type="RENDERER" value="-2.9"/>
	
        </attributes>

        <scenes>
            <scene name="Cube">
                <geometry name = "cube_skybox" type = "BOX"/>
				<SCALE x="5" y="5" z="5" />

            </scene>
        </scenes>

        <viewports>
            <viewport name="MainViewport">
			</viewport>
        </viewports>

        <cameras>
            <camera name="MainCamera">
				<viewport name="MainViewport" />
				<POSITION x="2" y="2" z="2" />
				<NEAR 	value="0.02" />
				<FAR 	value="100" /> 
				<LOOK_AT_POINT x="0.0" y="0.0" z="0.0"/>
			</camera>
        </cameras>

        
		<lights>
			<light name="Sun">
				<DIRECTION x="-0.5" y="-0.8" z="-0.5" />
			</light>
		</lights>

        <materialLibs>
            <materialLib filename="materials/simulation.mlib" />
            <materialLib filename="materials/voxel.mlib" />
            <!-- 
                <materialLib filename="rendering.mlib" />
            -->
		</materialLibs>
    </assets>

    <pipelines default="pipvox" mode="RUN_SEQUENTIAL">
		<pipeline name="simpip">
			<testScript file="scripts/pipelines.lua" script="SimController" />

			            <pass class="compute" name="Init">
                <mode value="RUN_ONCE"/>
                <material name="Init" fromLibrary="simulationLib" dimX="1" dimY="1" dimZ="1"/>
            </pass >

            
            <pass class="cudaPI" name="MyNewSort">
                
                <materialMaps>
                    <map fromMaterial="*" toMaterial="MyNewSort" toLibrary="simulationLib" />
                </materialMaps>
                
            </pass>

            
            
            <pass class="compute" name="DensityPressure">
                <material name="density_pressure" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS_DENSITY_PRESSURE" dimY="1" dimZ="1"/>
            </pass>
            <pass class="compute" name="Force">
                <material name="force" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
            </pass>
            <pass class="compute" name="Integrate">
                <material name="integrate" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
            </pass>


            <pass class="compute" name="UpdateIndex">
                <material name="UpdateIndex" fromLibrary="simulationLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
            </pass>
		</pipeline>
        <pipeline name="pipvox">
            
            

            <pass class="compute" name="vox_init">
				<preScript file="scripts/waves.lua" script="waves"/>
				<!--mode value="RUN_ONCE"/-->
                <material name="init" fromLibrary="voxelLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
            </pass>
			<pass class="compute" name="vox_extend">
				<!--mode value="RUN_ONCE"/-->
                <material name="newinitping" fromLibrary="voxelLib" dimX="VOX_SIDE_GROUPS_X" dimY="VOX_SIDE_GROUPS_Y" dimZ="VOX_SIDE_Z"/>
            </pass>
			<pass class="compute" name="vox_extend">
				<!--mode value="RUN_ONCE"/-->
                <material name="newinitpang" fromLibrary="voxelLib" dimX="VOX_SIDE_GROUPS_X" dimY="VOX_SIDE_GROUPS_Y" dimZ="VOX_SIDE_Z"/>
            </pass>
			<pass class="compute" name="vox_extend">
				<!--mode value="RUN_ONCE"/-->
                <material name="newinitpong" fromLibrary="voxelLib" dimX="VOX_SIDE_GROUPS_X" dimY="VOX_SIDE_GROUPS_Y" dimZ="VOX_SIDE_Z"/>
            </pass>
            
            <pass   class="default"     name="Cube">
				
                <scenes>
					<scene name="Cube" />
				</scenes>
                <camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>

            </pass>

            <pass   class="quad"        name="quad">
				<COLOR_CLEAR value="FALSE" />
				<DEPTH_CLEAR value="FALSE" />
                <preScript file="scripts/waves.lua" script="waves"/>
                <camera name="MainCamera" />

				<material name="quad" fromLibrary="voxelLib"/>
			</pass>
    
			

        </pipeline>
    </pipelines>
    <interface> 
		<window label = "Color/Thickness">
			<var label="Color"   			type="RENDERER" context="CURRENT" component="Particle_Color" 	mode="COLOR"/>
            <var label="Thin Color"   		type="RENDERER" context="CURRENT" component="Thin_Color" 		mode="COLOR"/>
            <var label="Thickness"			type="RENDERER" context="CURRENT" component="Particle_Thickness"	def="min=0.0 max=5.0" />
            
			<var label="Shlick power" 		type="RENDERER" context="CURRENT" component="shlickpower" 		def="min=0 max=10"/>
			<var label="specular power" 	type="RENDERER" context="CURRENT" component="specular_power" 	def="min=0 max=256"	/>
			
			<var label="ETA"				type="RENDERER" context="CURRENT" component="ETA"  				def="min=0 max=1"	/>
			
			<var label="DebugParticles"     type="RENDERER" context="CURRENT" component="DebugParticles" 	strings="Regular,Lighting,FrontBackOnly,Thickness"/>
			<var label="SkyboxType"     	type="RENDERER" context="CURRENT" component="SkyboxType" 		strings="Regular,White,Black"/>

			<var label="Maximum Refractions"	type="RENDERER" context="CURRENT" component="maxrefrat"  		def="min=0 max=20"	/>
			
			
		</window>
		
		<window label = "Voxel Grid Settings">
			<var label="Particle Radius"		type="RENDERER" context="CURRENT" component="particleradius"  	def="min=0.005 max=0.05"/>
			<var label="densityThreshold" 		type="RENDERER" context="CURRENT" component="densityThreshold" 	def="min=0 max=1"/>
			<var label="stepmultiplier" 		type="RENDERER" context="CURRENT" component="stepmultiplier" 	def="min=0 max=1"/>
			<var label="Blur Radius" 			type="RENDERER" context="CURRENT" component="blurradius"  		def="min=0 max=10"	/>
		</window>

		<window label="My Sim Controller">
            <var label="Pause"				type="RENDERER" context="CURRENT" component="Pause" 	def="min=0 max=1" />
			<var label="WAVE_NUM_DIR" 		type="RENDERER" context="CURRENT" component="WAVE_NUM_DIR" def="min=0 max=2" 	/>
			<var label="WAVE_PERIOD" 		type="RENDERER" context="CURRENT" component="WAVE_PERIOD" 	/>
			<var label="WAVE_STRENGTH" 		type="RENDERER" context="CURRENT" component="WAVE_STRENGTH" 	/>
			<var label="WAVE_CLEAR_BUTTON" 	type="RENDERER" context="CURRENT" component="WAVE_CLEAR" def="min=0 max=1"	/>
			<var label="Sim_Iters" 			type="RENDERER" context="CURRENT" component="Sim_Iters" 	/>
			<var label="Sim_MaxIters" 		type="RENDERER" context="CURRENT" component="Sim_MaxIters" 	/>
		</window>
		
		
		      <window label = "Simulation">
            <var label="Pause"                        type="RENDERER" context="CURRENT" component="Pause"   def="min=0 max=1" />
            <var label="Flow"                        type="RENDERER" context="CURRENT" component="Flow"   def="min=0 max=1" />
                  <var label="TIMESTEP"               type="RENDERER" context="CURRENT" component="TIMESTEP" def="min=0.001 step=0.001 max=0.05"/>
                  <var label="SURFACETENSION"   type="RENDERER" context="CURRENT" component="SURFACETENSION" def="min=0.0001 max=2 step=0.0001" />
                  <var label="STIFF"                        type="RENDERER" context="CURRENT" component="STIFF" def="min=0.1 max=10 step=0.1"/>
                  <var label="Wall damping"                 type="RENDERER" context="CURRENT" component="WALL_DAMPING" def="min=0 max=1 step=0.1"/>
                  <var label="RESTDENSITY"            type="RENDERER" context="CURRENT" component="RESTDENSITY" def="min=100 max=10000 step=100"/>
                  <var label="VISCOSITY"              type="RENDERER" context="CURRENT" component="VISCOSITY" def="min=3 max=25 step=0.1"/>
                  <var label="GRAVITY"                type="RENDERER" context="CURRENT" component="GRAVITY" def="min=-20 max=20 step=1"/>
                  <var label="RESTITUTION"            type="RENDERER" context="CURRENT" component="RESTITUTION" def="min=0 max=1 step=0.1"/>
                  <var label="SIMULATIONSCALE"        type="RENDERER" context="CURRENT" component="SIMULATIONSCALE" def="min=0 max=1 step=0.05"/>
                  <var label="SIMULATIONSCALE_FORCE"        type="RENDERER" context="CURRENT" component="SIMULATIONSCALEFORCE" def="min=0 max=2 step=0.05"/>
                  <var label="COLLISIONTYPE (0-fast 1-realistic)"             type="RENDERER" context="CURRENT" component="COLLISIONTYPE" def="min=0 max=1"/>
                  <var label="computeGravity"         type="RENDERER" context="CURRENT" component="computeGravity" def="min=0 max=1"/>
                  <var label="XMIN"                               type="RENDERER" context="CURRENT" component="XMIN" def="min=-10 max=10 step=0.01"/>
                  
        </window>
		
    </interface>
</project>