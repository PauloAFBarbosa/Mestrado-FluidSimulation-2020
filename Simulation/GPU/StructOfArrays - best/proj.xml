<?xml version="1.0"  encoding="UTF-8"?>
<project name="Particles" width = "1280" height = "720">
	<assets>
		<constants>
			<constant name="NUMBER_OF_PARTICLES" value="216000" />

			<!-- Lança com 625 workgroups. Cada workgroup vai ter 25 threads-->
			<constant name="NUMBER_OF_WORK_GROUPS" value="6750" />

			<!-- Lança com 100 workgroups. Cada workgroup vai ter 10 threads-->
			<constant name="NUMBER_OF_WORK_GROUPS_HASH" value="625" />

			<constant name="HASH_SIZE" value="20000" />
		</constants>
        <attributes>
			<attribute name="Particle_Radius" 			data="FLOAT" 	type="RENDERER" value="0.005"/>
			<attribute name="Particle_Resting_Density" 	data="INT" 		type="RENDERER" value="1000" />
			<attribute name="Particle_Mass" 			data="FLOAT" 	type="RENDERER" value="0.02" />
			<attribute name="Particle_Stiffness" 		data="INT" 		type="RENDERER" value="2000" />
			<attribute name="Number_Particles" 			data="INT" 		type="RENDERER" value="NUMBER_OF_PARTICLES"/>
			<attribute name="Particle_Color" 			data="VEC4" 	type="RENDERER" x="0.0" y="1.0" z="1.0" w="0.6"/>
			<attribute name="External_Force" 			data="VEC3" 	type="RENDERER" x="0" y="0.0" z="0.0" />
			<attribute name="Viscosity"					data="FLOAT" 	type="RENDERER" value="3000" />
			<attribute name="ETA"						data="FLOAT" 	type="RENDERER" value="1.1" />
			<attribute name="Pause"						data="INT" 		type="RENDERER" value="1" />
			<attribute name="Blur"						data="INT" 		type="RENDERER" value="0" />
			<attribute name="WhiteParticles"			data="INT" 		type="RENDERER" value="1" />
			<attribute name="Particle_alpha"			data="FLOAT" 	type="RENDERER" value="0.1" />
			<attribute name="Alpha_Threshold"			data="FLOAT" 	type="RENDERER" value="0.1" />
			<attribute name="Particle_Size"				data="VEC2" 	type="RENDERER" x="0.03" y="0.015" />
			<attribute name="Blur_Quality" data="FLOAT" type="RENDERER" value="4.106"  />
			<attribute name="Blur_Size" data="FLOAT" type="RENDERER" value="16.277"  />
			<!--Minha simulação do sph-->
			<attribute name="RESTITUTION"				data="FLOAT" type="RENDERER" value="0.5"/>
			<attribute name="TIMESTEP" 					data="FLOAT" type="RENDERER" value = "0.01" />
			<attribute name="SURFACETENSION" 			data="FLOAT" type="RENDERER" value = "0.0728" />
			<attribute name="THRESHOLD" 				data="FLOAT" type="RENDERER" value = "7.065" />
			<attribute name="H" 						data="FLOAT" type="RENDERER" value = "0.0457" />
			<attribute name="STIFF" 					data="FLOAT" type="RENDERER" value = "3.0" />
			<attribute name="DECLIVE" 					data="FLOAT" type="RENDERER" value = "0.0" />
			<attribute name="MASS" 						data="FLOAT" type="RENDERER" value = "0.02" />
			<attribute name="RESTDENSITY" 				data="FLOAT" type="RENDERER" value = "998.29" />
			<attribute name="VISCOSITY" 				data="FLOAT" type="RENDERER" value = "3.5" />
			<attribute name="GRAVITY" 					data="VEC4" type="RENDERER" x = "0" y = "-9.8" z = "0" w="0" />

			<attribute name="PONTOS_LADO" 				data="INT" 		type="RENDERER" value="60"/>
			<attribute name="HASHSIZE" 					data="INT" 		type="RENDERER" value="HASH_SIZE"/>
			<!--Usado para definir o volume onde vai ser feita a simulação-->
			<attribute name="XMIN" 						data="FLOAT" 		type="RENDERER" value="-2"/>
			<attribute name="YMIN" 						data="FLOAT" 		type="RENDERER" value="-2"/>
			<attribute name="ZMIN" 						data="FLOAT" 		type="RENDERER" value="-2"/>
			<attribute name="XMAX" 						data="FLOAT" 		type="RENDERER" value="2"/>
			<attribute name="YMAX" 						data="FLOAT" 		type="RENDERER" value="2"/>
			<attribute name="ZMAX" 						data="FLOAT" 		type="RENDERER" value="2"/>


		</attributes>
		<scenes>
			<scene name="Sphere">
				<geometry name = "sphere" type = "SPHERE" />
				<TRANSLATE x="1" y="1" z="1" />
				<SCALE x="0.025" y="0.05" z="0.025" />
			</scene>
			<scene name = "Skybox">
                <geometry name = "cube_skybox" type = "BOX" material="mat_skybox" />
            </scene>
			<scene name="Particles" >
				<buffers name="Position" primitive="POINTS" material="ParticlesBB">
					<position name="Position" fromLibrary="particleLib" />	
				</buffers>	
			</scene>
		</scenes>
		
		<viewports>
			<viewport name="MainViewport">
			</viewport>
		</viewports>
		
		<cameras>
			<camera name="MainCamera" >
				<viewport name="MainViewport" />
				<POSITION x="1.042" y="0.336" z="0.518" />
				<NEAR 	value="0.1" />
				<FAR 	value="1000" /> 
				<LOOK_AT_POINT x="0.0" y="-0.15" z="0.0"/>
			</camera>
		</cameras>
		
		<lights>
			<light name="Sun">
				<DIRECTION x="1" y="-1" z="0" />
			</light>
		</lights>

        <materialLibs>
			<materialLib filename="proj.mlib.xml" />
		</materialLibs>
	</assets>
	
	<pipelines>
		<pipeline name="pip" >
			<pass class="compute" name="Init">
				<mode value="RUN_ONCE"/>
				<material name="Init" fromLibrary="particleLib" dimX="1" dimY="1" dimZ="1"/>
			</pass >
			<pass class="compute" name="Populate">
				<mode value="RUN_ONCE"/>
				<material name="Populate" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass >
			<pass class="compute" name="DensityPressure">
				
				<material name="density_pressure" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>
			<pass class="compute" name="Force">
				
				<material name="force" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>
			<pass class="compute" name="Integrate">
				
				<material name="integrate" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>
			<pass class="compute" name="ZeroBuffers">
				
				<material name="ZeroBuffers" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS_HASH" dimY="1" dimZ="1"/>
			</pass>
			
			<pass class="compute" name="ComputeTemps">
				
				<material name="ComputeTemps" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>

			<pass class="compute" name="ComputeOffsets">
				
				<material name="ComputeOffsets" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS_HASH" dimY="1" dimZ="1"/>
			</pass>

			<pass class="compute" name="UpdateHash">

				<material name="UpdateHash" fromLibrary="particleLib" dimX="NUMBER_OF_WORK_GROUPS" dimY="1" dimZ="1"/>
			</pass>

			
			
			
			<pass class="default" name="background">
				<scenes>
					<scene name="Skybox" />
				</scenes>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<renderTarget name="Background" fromLibrary="particleLib" />
				<materialMaps>
					<map fromMaterial="mat_skybox" toMaterial="mat_skybox" toLibrary="particleLib" />
				</materialMaps>
				<injectionMaps>
					<map toMaterial="mat_skybox">
						<state name="cull" fromLibrary="particleLib" />
					</map>
				</injectionMaps>
			</pass>
			<pass class="default" name="sceneRender">
				<!--DEPTH_CLEAR value="False"/-->
				<scenes>
					<scene name ="Particles"/>
				</scenes>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<materialMaps>
					<map fromMaterial="ParticlesBB" toMaterial="Thickness" toLibrary="particleLib" />
				</materialMaps>
				<renderTarget name="Render" fromLibrary="particleLib" />
			</pass>
			<pass class="default" name="DepthRender">
				<scenes>
					
					<scene name ="Particles"/>
				</scenes>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<materialMaps>
					<map fromMaterial="ParticlesBB" toMaterial="FrontFaceDepth" toLibrary="particleLib" />
				</materialMaps>
				<renderTarget name="SpherePos" fromLibrary="particleLib" />
			</pass>

			<pass class="default" name="NormalRender">
				<scenes>
					<scene name ="Particles"/>
				</scenes>
				<camera name="MainCamera" />
				<lights>
					<light name="Sun" />
				</lights>
				<materialMaps>
					<map fromMaterial="ParticlesBB" toMaterial="NormalMapFront" toLibrary="particleLib" />
				</materialMaps>
				<renderTarget name="NormalMap" fromLibrary="particleLib" />
			</pass>
			
			<pass class="quad" name="particlesQuad">
			 	<camera name="MainCamera" />
				<viewport name="MainViewport" />
				<material name="FinalStep" fromLibrary="particleLib" />
			</pass>
			
		</pipeline>
	</pipelines>

    <interface> 
		<window label = "Render Mode">
            <var label="Color"   	type="RENDERER" context="CURRENT" component="Particle_Color" 	mode="COLOR"/>
            <var label="ETA"		type="RENDERER" context="CURRENT" component="ETA" 	/>
            <var label="Particle_alpha"		type="RENDERER" context="CURRENT" component="Particle_alpha" def="min=0.1 max=1" />
            <var label="Alpha_Threshold"		type="RENDERER" context="CURRENT" component="Alpha_Threshold" def="min=0 max=1" />
            <var label="Particle_Size"		type="RENDERER" context="CURRENT" component="Particle_Size" def="min=0.005 max=0.05"/>
            <var label="Blur"		type="RENDERER" context="CURRENT" component="Blur" def="min=0 max=1" />
			<var label="Blur Radious" 	type="RENDERER" context="CURRENT" component="Blur_Size" 	def="min=4.0 max=32.0"/>
			<var label="Blur_Quality" 	type="RENDERER" context="CURRENT" component="Blur_Quality" 	def="min=1.0 max=20.0"/>
            <var label="WhiteParticles"		type="RENDERER" context="CURRENT" component="WhiteParticles" def="min=0 max=1"/>
        </window>
		<window label = "Simulation">
            <var label="External_Force" 	type="RENDERER" context="CURRENT" component="External_Force" 	def="min=-20 step=1 max=20.0"/>
            <var label="Viscosity"	type="RENDERER" context="CURRENT" component="Viscosity" def="min=300 max=3000"	/>
            <var label="Pause"		type="RENDERER" context="CURRENT" component="Pause" 	def="min=0 max=1" />

   
			<var label="TIMESTEP" 			type="RENDERER" context="CURRENT" component="TIMESTEP" def="min=0.001 step=0.001 max=2"/>
			<var label="SURFACETENSION" 	type="RENDERER" context="CURRENT" component="SURFACETENSION" def="min=0.0001 max=2 step=0.0001" />
			<var label="H" 					type="RENDERER" context="CURRENT" component="H" def="min=0.0001 max=100 step=0.0001"/>
			<var label="STIFF" 				type="RENDERER" context="CURRENT" component="STIFF" def="min=1 max=100 step=1"/>
			<var label="DECLIVE" 			type="RENDERER" context="CURRENT" component="DECLIVE" def="min=-1.0 max=1 step=0.05"/>
			<var label="RESTDENSITY" 		type="RENDERER" context="CURRENT" component="RESTDENSITY" def="min=100 max=10000 step=100"/>
			<var label="VISCOSITY" 			type="RENDERER" context="CURRENT" component="VISCOSITY" def="min=3 max=25 step=0.1"/>
			<var label="GRAVITY" 			type="RENDERER" context="CURRENT" component="GRAVITY" def="min=-200 max=200 step=1"/>
			<var label="RESTITUTION" 			type="RENDERER" context="CURRENT" component="RESTITUTION" def="min=-10 max=10 step=0.1"/>
        </window>
    </interface>
	 
</project>